<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>The Yiye Universe</title>
        <style>
            html, body {
                width: 100%;
                height: 100%;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    -khtml-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;

            }

            body {
                background-color: #ffffff;
                margin: 0;
                overflow: hidden;
                font-family: arial;
            }

            #blocker {

                position: absolute;

                width: 100%;
                height: 100%;

                background-color: rgba(0,0,0,0.5);

            }

            #instructions {

                width: 100%;
                height: 100%;

                display: -webkit-box;
                display: -moz-box;
                display: box;

                -webkit-box-orient: horizontal;
                -moz-box-orient: horizontal;
                box-orient: horizontal;

                -webkit-box-pack: center;
                -moz-box-pack: center;
                box-pack: center;

                -webkit-box-align: center;
                -moz-box-align: center;
                box-align: center;

                color: #ffffff;
                text-align: centre;

                cursor: pointer;

            }
			
			#txt {


                display: -webkit-box;
                display: -moz-box;
                display: box;

                -webkit-box-orient: horizontal;
                -moz-box-orient: horizontal;
                box-orient: horizontal;

                -webkit-box-pack: top;
                -moz-box-pack: top;
                box-pack: top;

                -webkit-box-align: centre;
                -moz-box-align: centre;
                box-align: centre;

                color: #ffffff;
                align: center;
background-color: rgba(0, 255, 255, 0.0);
                cursor: pointer;

            }

        </style>
		
		<script>
function startTime() {
    var today=new Date();
    var h=today.getHours();
    var m=today.getMinutes();
    var s=today.getSeconds();
    m = checkTime(m);
    s = checkTime(s);
    document.getElementById('txt').innerHTML = h+":"+m+":"+s;
    var t = setTimeout(function(){startTime()},500);
}

function checkTime(i) {
    if (i<10) {i = "0" + i};  // add zero in front of numbers < 10
    return i;
}
</script>

    </head>
    <body onload="startTime()">
				
        <script src="libs/Three.js"></script>
		<script src="ThreeCSG.js"></script>
        <script src="build/cannon.js"></script>
        <script src="js/PointerLockControls.js"></script>
		<script src="js/stats.min.js"></script>
		 
        <div id="blocker">

            <div id="instructions">
			<center>
			<div id="txt"></div>
			<br>
			<center>
			<img src="images/logolarge.png" width="100%" height="auto"><br>
                <span style="font-size:40px">CLICK TO PLAY</span>
                <br />
                (W,A,S,D = Move, SPACE = Jump, MOUSE = Look, CLICK = Shoot) <br />
			<i>	Pre-ALPHA </i> <br />
			<br />
			<a href="javascript:history.go(0)"> <img src="images/reset.png"> </a>
			<br>
			

        </div>
        <script>

            var sphereShape, sphereBody, world, physicsMaterial, walls=[], balls=[], ballMeshes=[], boxes=[], boxMeshes=[];

            var camera, scene, renderer;
            var geometry, material, mesh;
            var controls,time = Date.now();

            var blocker = document.getElementById( 'blocker' );
            var instructions = document.getElementById( 'instructions' );
			
			var stats = new Stats();
stats.setMode(0); // 0: fps, 1: ms
// align top-left
stats.domElement.style.position = 'absolute';
stats.domElement.style.left = '0px';
stats.domElement.style.top = '0px';

document.body.appendChild( stats.domElement );

            var havePointerLock = 'pointerLockElement' in document || 'mozPointerLockElement' in document || 'webkitPointerLockElement' in document;

            if ( havePointerLock ) {

                var element = document.body;

                var pointerlockchange = function ( event ) {

                    if ( document.pointerLockElement === element || document.mozPointerLockElement === element || document.webkitPointerLockElement === element ) {

                        controls.enabled = true;

                        blocker.style.display = 'none';

                    } else {

                        controls.enabled = false;

                        blocker.style.display = '-webkit-box';
                        blocker.style.display = '-moz-box';
                        blocker.style.display = 'box';

                        instructions.style.display = '';

                    }

                }

                var pointerlockerror = function ( event ) {
                    instructions.style.display = '';
                }

                // Hook pointer lock state change events
                document.addEventListener( 'pointerlockchange', pointerlockchange, false );
                document.addEventListener( 'mozpointerlockchange', pointerlockchange, false );
                document.addEventListener( 'webkitpointerlockchange', pointerlockchange, false );

                document.addEventListener( 'pointerlockerror', pointerlockerror, false );
                document.addEventListener( 'mozpointerlockerror', pointerlockerror, false );
                document.addEventListener( 'webkitpointerlockerror', pointerlockerror, false );

                instructions.addEventListener( 'click', function ( event ) {
                    instructions.style.display = 'none';

                    // Ask the browser to lock the pointer
                    element.requestPointerLock = element.requestPointerLock || element.mozRequestPointerLock || element.webkitRequestPointerLock;

                    if ( /Firefox/i.test( navigator.userAgent ) ) {

                        var fullscreenchange = function ( event ) {

                            if ( document.fullscreenElement === element || document.mozFullscreenElement === element || document.mozFullScreenElement === element ) {

                                document.removeEventListener( 'fullscreenchange', fullscreenchange );
                                document.removeEventListener( 'mozfullscreenchange', fullscreenchange );

                                element.requestPointerLock();
                            }

                        }

                        document.addEventListener( 'fullscreenchange', fullscreenchange, false );
                        document.addEventListener( 'mozfullscreenchange', fullscreenchange, false );

                        element.requestFullscreen = element.requestFullscreen || element.mozRequestFullscreen || element.mozRequestFullScreen || element.webkitRequestFullscreen;

                        element.requestFullscreen();

                    } else {

                        element.requestPointerLock();

                    }

                }, false );

            } else {

                instructions.innerHTML = 'Your browser doesn\'t seem to support Pointer Lock API';

            }

            initCannon();
            init();
            animate();

            function initCannon(){
                // Setup our world
                world = new CANNON.World();
                world.quatNormalizeSkip = 0;
                world.quatNormalizeFast = false;

                var solver = new CANNON.GSSolver();

                world.defaultContactMaterial.contactEquationStiffness = 1e9;
                world.defaultContactMaterial.contactEquationRegularizationTime = 4;

                solver.iterations = 7;
                solver.tolerance = 0.1;
                var split = true;
                if(split)
                    world.solver = new CANNON.SplitSolver(solver);
                else
                    world.solver = solver;

                world.gravity.set(0,-20,0);
                world.broadphase = new CANNON.NaiveBroadphase();

                // Create a slippery material (friction coefficient = 0.0)
                physicsMaterial = new CANNON.Material("slipperyMaterial");
                var physicsContactMaterial = new CANNON.ContactMaterial(physicsMaterial,
                                                                        physicsMaterial,
                                                                        0.0, // friction coefficient
                                                                        0.3  // restitution
                                                                        );
                // We must add the contact materials to the world
                world.addContactMaterial(physicsContactMaterial);

                // Create a sphere THIS IS THE PLAYER
                var mass = 8, radius = 0.825;
				//var mass = 5, radius = 1.3;
                sphereShape = new CANNON.Sphere(radius);
                sphereBody = new CANNON.Body({ mass: mass });
                sphereBody.addShape(sphereShape);
                sphereBody.position.set(0,66,0);
                sphereBody.linearDamping = 0.999;
                world.add(sphereBody);

                // Create a plane
                var groundShape = new CANNON.Plane(10,30,10);
                var groundBody = new CANNON.Body({ mass: 0 });
                groundBody.addShape(groundShape);
                groundBody.quaternion.setFromAxisAngle(new CANNON.Vec3(1,0,0),-Math.PI/2);
                world.add(groundBody);
            }

            function init() {

                camera = new THREE.PerspectiveCamera( 90, window.innerWidth / window.innerHeight, 0.1, 50000 );
				sphereBody.position.set(0,66,0);
				var camlight = new THREE.PointLight(0xFFFFFF, 0.5, 1 );
					camera.add(camlight);

                scene = new THREE.Scene();
                scene.fog = new THREE.Fog( 0xffffff, 0, 1000 );

                var ambient = new THREE.AmbientLight( 0x444444 );
                scene.add( ambient );

				
                light = new THREE.SpotLight( 0xFFFFF2,1.55 );
                light.position.set( -100, 300, 200 );
                light.target.position.set( 0, 0, 0 );
                if(true){
                    light.castShadow = true;

                    light.shadowCameraNear = 2;
                    light.shadowCameraFar = 1000;//camera.far;
                    light.shadowCameraFov = 40;

                    light.shadowMapBias = 0.5;
                    light.shadowMapDarkness = 0.7;
                    light.shadowMapWidth = 8*512;
                    light.shadowMapHeight = 8*512;

                  //  light.shadowCameraVisible = true;
                }
                scene.add( light );
 
/* light2 = new THREE.SpotLight( 0xFFFFF2,1.5 );
                light2.position.set( 100, 300, 200 );
                light2.target.position.set( 0, 0, 0 );
					scene.add(light2);

*/
                controls = new PointerLockControls( camera , sphereBody );
                scene.add( controls.getObject() );

                // floor
                geometry = new THREE.PlaneGeometry( 10, 30, 50, 50 );
                geometry.applyMatrix( new THREE.Matrix4().makeRotationX( - Math.PI / 2 ) );

                material = new THREE.MeshPhongMaterial( { color: 0xdddddd} );
				spellmaterial = new THREE.MeshBasicMaterial( { color: 0xFF9500, map: new THREE.ImageUtils.loadTexture("tex/spelltex.jpg")} );

                mesh = new THREE.Mesh( geometry, material );
                mesh.castShadow = true;
                mesh.receiveShadow = true;
                scene.add( mesh );

				//Cylinder for menu
var menugeometry = new THREE.CylinderGeometry( 0.5, 0.5, 10, 16 );
var menumaterial = new THREE.MeshBasicMaterial( {color: 0x000000, side: THREE.BackSide} );
var menucylinder = new THREE.Mesh( menugeometry, menumaterial );
scene.add( menucylinder );

				//Rendering and all that jazz
                renderer = new THREE.WebGLRenderer({antialias:false});
				renderer.sortObjects = false
                renderer.shadowMapEnabled = true;
                renderer.shadowMapSoft = false;
                renderer.setSize( window.innerWidth, window.innerHeight );
                renderer.setClearColor( scene.fog.color, 1 );

                document.body.appendChild( renderer.domElement );

                window.addEventListener( 'resize', onWindowResize, false );

              //TEST AREA NOTIFICATION
			  var testgeometry = new THREE.PlaneGeometry( 20, 20, 1 );
var testmaterial = new THREE.MeshBasicMaterial( {map: THREE.ImageUtils.loadTexture( 'tex/testarea.gif' ), transparent:true, side: THREE.DoubleSide} );
var testplane = new THREE.Mesh( testgeometry, testmaterial );
scene.add( testplane );
testplane.position.set(0,20,0);
testplane.rotation.x = -90 * Math.PI / 180;

			  // Add boxes
                var halfExtents = new CANNON.Vec3(1,1,1);
                var boxShape = new CANNON.Box(halfExtents);
                var boxGeometry = new THREE.BoxGeometry(halfExtents.x*2,halfExtents.y*2,halfExtents.z*2);
                for(var i=0; i<7; i++){
                    var x = (Math.random()-0.5)*20;
                    var y = 1 + (Math.random()-0.5)*1;
                    var z = (Math.random()-0.5)*20;
                    var boxBody = new CANNON.Body({ mass: 5 });
                    boxBody.addShape(boxShape);
                    var boxMesh = new THREE.Mesh( boxGeometry, material );
                    world.add(boxBody);
                    scene.add(boxMesh);
                    boxBody.position.set(x,y,z);
                    boxMesh.position.set(x,y,z);
                    boxMesh.castShadow = true;
                    boxMesh.receiveShadow = true;
                    boxes.push(boxBody);
                    boxMeshes.push(boxMesh);
                }

 //City Floor BOX
 var floorTexture = new THREE.ImageUtils.loadTexture( 'tex/street2.jpg' );
	floorTexture.wrapS = floorTexture.wrapT = THREE.RepeatWrapping; 
	floorTexture.repeat.set( 15, 45 );
	 var floorbumpTexture = new THREE.ImageUtils.loadTexture( 'tex/street3-bump.jpg' );
	floorbumpTexture.wrapS = floorbumpTexture.wrapT = THREE.RepeatWrapping; 
	floorbumpTexture.repeat.set( 15, 45 );
var patramaterial = new THREE.MeshPhongMaterial({
        map: floorTexture,
		bumpMap: floorbumpTexture,
		bumpScale: 0.0085
      });
 var halfExtents = new CANNON.Vec3(6,0.002,18);
                var boxShape = new CANNON.Box(halfExtents);
                var boxGeometry = new THREE.BoxGeometry(halfExtents.x*2,halfExtents.y*2,halfExtents.z*2);
				var x = 0;
                    var y = 65;
                    var z = 0;
				//var boxBody = new CANNON.Body({ mass: 0 });
				var boxBody = new CANNON.Body({ mass: 0 });
                    boxBody.addShape(boxShape);
                    var boxMesh = new THREE.Mesh( boxGeometry, patramaterial );
                    world.add(boxBody);
                    scene.add(boxMesh);
                    boxBody.position.set(x,y,z);
                    boxMesh.position.set(x,y,z);
                    boxMesh.castShadow = true;
                    boxMesh.receiveShadow = true;
                    boxes.push(boxBody);
                    boxMeshes.push(boxMesh);
					
//Sideboxes
 var floorTexture = new THREE.ImageUtils.loadTexture( 'tex/street2.jpg' );
	floorTexture.wrapS = floorTexture.wrapT = THREE.RepeatWrapping; 
	floorTexture.repeat.set( 10, 45 );
	 var floorbumpTexture = new THREE.ImageUtils.loadTexture( 'tex/street3-bump.jpg' );
	floorbumpTexture.wrapS = floorbumpTexture.wrapT = THREE.RepeatWrapping; 
	floorbumpTexture.repeat.set( 10, 45 );
var patramaterial = new THREE.MeshPhongMaterial({
        map: floorTexture,
		bumpMap: floorbumpTexture,
		bumpScale: 0.0085
      });
 var halfExtents = new CANNON.Vec3(4,0.002,18);
                var boxShape = new CANNON.Box(halfExtents);
                var boxGeometry = new THREE.BoxGeometry(halfExtents.x*2,halfExtents.y*2,halfExtents.z*2);
				var x = -14;
                    var y = 65;
                    var z = 0;
				//var boxBody = new CANNON.Body({ mass: 0 });
				var boxBody = new CANNON.Body({ mass: 0 });
                    boxBody.addShape(boxShape);
                    var boxMesh = new THREE.Mesh( boxGeometry, patramaterial );
                    world.add(boxBody);
                    scene.add(boxMesh);
                    boxBody.position.set(x,y,z);
                    boxMesh.position.set(x,y,z);
                    boxMesh.castShadow = true;
                    boxMesh.receiveShadow = true;
                    boxes.push(boxBody);
                    boxMeshes.push(boxMesh);
 var halfExtents = new CANNON.Vec3(4,0.002,18);
                var boxShape = new CANNON.Box(halfExtents);
                var boxGeometry = new THREE.BoxGeometry(halfExtents.x*2,halfExtents.y*2,halfExtents.z*2);
				var x = 14;
                    var y = 65;
                    var z = 0;
				//var boxBody = new CANNON.Body({ mass: 0 });
				var boxBody = new CANNON.Body({ mass: 0 });
                    boxBody.addShape(boxShape);
                    var boxMesh = new THREE.Mesh( boxGeometry, patramaterial );
                    world.add(boxBody);
                    scene.add(boxMesh);
                    boxBody.position.set(x,y,z);
                    boxMesh.position.set(x,y,z);
                    boxMesh.castShadow = true;
                    boxMesh.receiveShadow = true;
                    boxes.push(boxBody);
                    boxMeshes.push(boxMesh);

//Side Connectors
 var floorTexture = new THREE.ImageUtils.loadTexture( 'tex/street2.jpg' );
	floorTexture.wrapS = floorTexture.wrapT = THREE.RepeatWrapping; 
	floorTexture.repeat.set( 30, 10 );
	 var floorbumpTexture = new THREE.ImageUtils.loadTexture( 'tex/street3-bump.jpg' );
	floorbumpTexture.wrapS = floorbumpTexture.wrapT = THREE.RepeatWrapping; 
	floorbumpTexture.repeat.set( 30, 10 );		
var patramaterial = new THREE.MeshPhongMaterial({
        map: floorTexture,
		bumpMap: floorbumpTexture,
		bumpScale: 0.0085
      });	
 var halfExtents = new CANNON.Vec3(12,0.002,4);
                var boxShape = new CANNON.Box(halfExtents);
                var boxGeometry = new THREE.BoxGeometry(halfExtents.x*2,halfExtents.y*2,halfExtents.z*2);
				var x = 18;
                    var y = 65;
                    var z = 22;
				//var boxBody = new CANNON.Body({ mass: 0 });
				var boxBody = new CANNON.Body({ mass: 0 });
                    boxBody.addShape(boxShape);
                    var boxMesh = new THREE.Mesh( boxGeometry, patramaterial );
                    world.add(boxBody);
                    scene.add(boxMesh);
                    boxBody.position.set(x,y,z);
                    boxMesh.position.set(x,y,z);
                    boxMesh.castShadow = true;
                    boxMesh.receiveShadow = true;
                    boxes.push(boxBody);
                    boxMeshes.push(boxMesh);
var halfExtents = new CANNON.Vec3(12,0.002,4);
                var boxShape = new CANNON.Box(halfExtents);
                var boxGeometry = new THREE.BoxGeometry(halfExtents.x*2,halfExtents.y*2,halfExtents.z*2);
				var x = -18;
                    var y = 65;
                    var z = 22;
				//var boxBody = new CANNON.Body({ mass: 0 });
				var boxBody = new CANNON.Body({ mass: 0 });
                    boxBody.addShape(boxShape);
                    var boxMesh = new THREE.Mesh( boxGeometry, patramaterial );
                    world.add(boxBody);
                    scene.add(boxMesh);
                    boxBody.position.set(x,y,z);
                    boxMesh.position.set(x,y,z);
                    boxMesh.castShadow = true;
                    boxMesh.receiveShadow = true;
                    boxes.push(boxBody);
                    boxMeshes.push(boxMesh);
					
					//colour, intensity, radius
					var balllight2 = new THREE.PointLight(0xFF9500, 1.5, 4 );
					balllight2.position.set(-8,66,-6);
					scene.add(balllight2);
	
//STRAW DETAIL
 var strawTexture = new THREE.ImageUtils.loadTexture( 'tex/details/straw.png' );
 var strawMaterial = new THREE.MeshBasicMaterial( {map: strawTexture, transparent: true, side: THREE.FrontSide} );
var plane = new THREE.Mesh( new THREE.PlaneGeometry( 1.5, 1.5, 1 ), strawMaterial );	
scene.add(plane);
plane.position.set(-5,65.0025,-18);
plane.rotation.x = - 90 * ( Math.PI / 180 );
plane.rotation.z = 	 33 * ( Math.PI / 180 );
 
 var strawTexture = new THREE.ImageUtils.loadTexture( 'tex/details/poster1.gif' );
 var strawMaterial = new THREE.MeshLambertMaterial( {map: strawTexture, transparent: true, side: THREE.FrontSide} );
var plane = new THREE.Mesh( new THREE.PlaneGeometry( 0.5, 0.5, 1 ), strawMaterial );	
scene.add(plane);
plane.position.set(-6.001,64,-10);
plane.rotation.y = 	 -90 * ( Math.PI / 180 );
plane.rotation.z = 	 24 * ( Math.PI / 180 );


//City Floor BOX 2
 var floorTexture = new THREE.ImageUtils.loadTexture( 'tex/street2.jpg' );
	floorTexture.wrapS = floorTexture.wrapT = THREE.RepeatWrapping; 
	floorTexture.repeat.set( 15, 45 );
	 var floorbumpTexture = new THREE.ImageUtils.loadTexture( 'tex/street3-bump.jpg' );
	floorbumpTexture.wrapS = floorbumpTexture.wrapT = THREE.RepeatWrapping; 
	floorbumpTexture.repeat.set( 15, 45 );
var patramaterial = new THREE.MeshPhongMaterial({
        map: floorTexture,
		bumpMap: floorbumpTexture,
		bumpScale: 0.0085
      });
 var halfExtents = new CANNON.Vec3(6,0.002,18);
                var boxShape = new CANNON.Box(halfExtents);
                var boxGeometry = new THREE.BoxGeometry(halfExtents.x*2,halfExtents.y*2,halfExtents.z*2);
				var x = 0;
                    var y = 65;
                    var z = 36;
				//var boxBody = new CANNON.Body({ mass: 0 });
				var boxBody = new CANNON.Body({ mass: 0 });
                    boxBody.addShape(boxShape);
                    var boxMesh = new THREE.Mesh( boxGeometry, patramaterial );
                    world.add(boxBody);
                    scene.add(boxMesh);
                    boxBody.position.set(x,y,z);
                    boxMesh.position.set(x,y,z);
                    boxMesh.castShadow = true;
                    boxMesh.receiveShadow = true;
                    boxes.push(boxBody);
                    boxMeshes.push(boxMesh);
					
					//More box
					var halfExtents = new CANNON.Vec3(6,0.002,18);
                var boxShape = new CANNON.Box(halfExtents);
                var boxGeometry = new THREE.BoxGeometry(halfExtents.x*2,halfExtents.y*2,halfExtents.z*2);
				var x = 0;
                    var y = 65;
                    var z = 72;
				//var boxBody = new CANNON.Body({ mass: 0 });
				var boxBody = new CANNON.Body({ mass: 0 });
                    boxBody.addShape(boxShape);
                    var boxMesh = new THREE.Mesh( boxGeometry, patramaterial );
                    world.add(boxBody);
                    scene.add(boxMesh);
                    boxBody.position.set(x,y,z);
                    boxMesh.position.set(x,y,z);
                    boxMesh.castShadow = true;
                    boxMesh.receiveShadow = true;
                    boxes.push(boxBody);
                    boxMeshes.push(boxMesh);
//Trees
var bark = new THREE.ImageUtils.loadTexture("tex/bark2.jpg"); 
bark.wrapS = bark.wrapT = THREE.RepeatWrapping; 
	bark.repeat.set( 6, 12 );

var loader = new THREE.ObjectLoader();	
loader.load("models/twistedtree.js", 
    function ( obj ) {
	obj.material.map = bark;
	obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(0,65,8);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);


var ferntex = new THREE.ImageUtils.loadTexture("tex/fern.png"); 
var loader = new THREE.ObjectLoader();	
loader.load("models/fern.js", 
    function ( obj ) {
	obj.material.map = ferntex;
	obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.2, 0.2, 0.2 );
	   obj.position.set(5.7,65,8.1);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
loader.load("models/tree1.js", 
    function ( obj ) {
	obj.material.map = bark;
	obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.3, 0.3, 0.2 );
	   obj.position.set(-5.7,64.5,-12);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
loader.load("models/tree1.js", 
    function ( obj ) {
	obj.material.map = bark;
	obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.21, 0.212, 0.21 );
	   obj.position.set(5.8,64.8,-12.2);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
//City Floor BOX Right
 var floorTexture = new THREE.ImageUtils.loadTexture( 'tex/street2.jpg' );
	floorTexture.wrapS = floorTexture.wrapT = THREE.RepeatWrapping; 
	floorTexture.repeat.set( 15, 75 );
	 var floorbumpTexture = new THREE.ImageUtils.loadTexture( 'tex/street3-bump.jpg' );
	floorbumpTexture.wrapS = floorbumpTexture.wrapT = THREE.RepeatWrapping; 
	floorbumpTexture.repeat.set( 15, 75 );
var patramaterial = new THREE.MeshPhongMaterial({
        map: floorTexture,
		bumpMap: floorbumpTexture,
		bumpScale: 0.0085
      });

//SidePaths
 var halfExtents = new CANNON.Vec3(6,0.002,30);
                var boxShape = new CANNON.Box(halfExtents);
                var boxGeometry = new THREE.BoxGeometry(halfExtents.x*2,halfExtents.y*2,halfExtents.z*2);
				var x = 24;
                    var y = 65;
                    var z = -12;
				//var boxBody = new CANNON.Body({ mass: 0 });
				var boxBody = new CANNON.Body({ mass: 0 });
                    boxBody.addShape(boxShape);
                    var boxMesh = new THREE.Mesh( boxGeometry, patramaterial );
                    world.add(boxBody);
                    scene.add(boxMesh);
                    boxBody.position.set(x,y,z);
                    boxMesh.position.set(x,y,z);
                    boxMesh.castShadow = true;
                    boxMesh.receiveShadow = true;
                    boxes.push(boxBody);
                    boxMeshes.push(boxMesh);
var halfExtents = new CANNON.Vec3(6,0.002,30);
                var boxShape = new CANNON.Box(halfExtents);
                var boxGeometry = new THREE.BoxGeometry(halfExtents.x*2,halfExtents.y*2,halfExtents.z*2);
				var x = -24;
                    var y = 65;
                    var z = -12;
				//var boxBody = new CANNON.Body({ mass: 0 });
				var boxBody = new CANNON.Body({ mass: 0 });
                    boxBody.addShape(boxShape);
                    var boxMesh = new THREE.Mesh( boxGeometry, patramaterial );
                    world.add(boxBody);
                    scene.add(boxMesh);
                    boxBody.position.set(x,y,z);
                    boxMesh.position.set(x,y,z);
                    boxMesh.castShadow = true;
                    boxMesh.receiveShadow = true;
                    boxes.push(boxBody);
                    boxMeshes.push(boxMesh);
										
					
//Lower floor
 var floorTexture = new THREE.ImageUtils.loadTexture( 'tex/street2.jpg' );
	floorTexture.wrapS = floorTexture.wrapT = THREE.RepeatWrapping; 
	floorTexture.repeat.set( 90, 90 );
	 var floorbumpTexture = new THREE.ImageUtils.loadTexture( 'tex/street3-bump.jpg' );
	floorbumpTexture.wrapS = floorbumpTexture.wrapT = THREE.RepeatWrapping; 
	floorbumpTexture.repeat.set( 90, 90 );
	var patramaterial = new THREE.MeshPhongMaterial({
        map: floorTexture,
		bumpMap: floorbumpTexture,
		bumpScale: 0.0085
      });
 var halfExtents = new CANNON.Vec3(36,0.002,36);
                var boxShape = new CANNON.Box(halfExtents);
                var boxGeometry = new THREE.BoxGeometry(halfExtents.x*2,halfExtents.y*2,halfExtents.z*2);
				var x = 0;
                    var y = 63;
                    var z = 18;
				//var boxBody = new CANNON.Body({ mass: 0 });
				var boxBody = new CANNON.Body({ mass: 0 });
                    boxBody.addShape(boxShape);
                    var boxMesh = new THREE.Mesh( boxGeometry, patramaterial );
                    world.add(boxBody);
                    scene.add(boxMesh);
                    boxBody.position.set(x,y,z);
                    boxMesh.position.set(x,y,z);
                    boxMesh.castShadow = true;
                    boxMesh.receiveShadow = true;
                    boxes.push(boxBody);
                    boxMeshes.push(boxMesh);
					
//Even Lower
 var floorTexture = new THREE.ImageUtils.loadTexture( 'tex/street2.jpg' );
	floorTexture.wrapS = floorTexture.wrapT = THREE.RepeatWrapping; 
	floorTexture.repeat.set( 180, 180 );
	 var floorbumpTexture = new THREE.ImageUtils.loadTexture( 'tex/street3-bump.jpg' );
	floorbumpTexture.wrapS = floorbumpTexture.wrapT = THREE.RepeatWrapping; 
	floorbumpTexture.repeat.set( 180, 180 );
	var patramaterial = new THREE.MeshPhongMaterial({
        map: floorTexture,
		bumpMap: floorbumpTexture,
		bumpScale: 0.0085
      });
 var halfExtents = new CANNON.Vec3(72,0.002,72);
                var boxShape = new CANNON.Box(halfExtents);
                var boxGeometry = new THREE.BoxGeometry(halfExtents.x*2,halfExtents.y*2,halfExtents.z*2);
				var x = 0;
                    var y = 55;
                    var z = 36;
				//var boxBody = new CANNON.Body({ mass: 0 });
				var boxBody = new CANNON.Body({ mass: 0 });
                    boxBody.addShape(boxShape);
                    var boxMesh = new THREE.Mesh( boxGeometry, patramaterial );
                    world.add(boxBody);
                    scene.add(boxMesh);
                    boxBody.position.set(x,y,z);
                    boxMesh.position.set(x,y,z);
                    boxMesh.castShadow = true;
                    boxMesh.receiveShadow = true;
                    boxes.push(boxBody);
                    boxMeshes.push(boxMesh);

					
					 var floorTexture = new THREE.ImageUtils.loadTexture( 'tex/street2.jpg' );
	floorTexture.wrapS = floorTexture.wrapT = THREE.RepeatWrapping; 
	floorTexture.repeat.set( 45, 30 );
	 var floorbumpTexture = new THREE.ImageUtils.loadTexture( 'tex/street3-bump.jpg' );
	floorbumpTexture.wrapS = floorbumpTexture.wrapT = THREE.RepeatWrapping; 
	floorbumpTexture.repeat.set( 45, 30 );
	var patramaterial = new THREE.MeshPhongMaterial({
        map: floorTexture,
		bumpMap: floorbumpTexture,
		bumpScale: 0.0085
      });
 var halfExtents = new CANNON.Vec3(18,0.002,12);
                var boxShape = new CANNON.Box(halfExtents);
                var boxGeometry = new THREE.BoxGeometry(halfExtents.x*2,halfExtents.y*2,halfExtents.z*2);
				var x = 0;
                    var y = 65;
                    var z = -30;
				//var boxBody = new CANNON.Body({ mass: 0 });
				var boxBody = new CANNON.Body({ mass: 0 });
                    boxBody.addShape(boxShape);
                    var boxMesh = new THREE.Mesh( boxGeometry, patramaterial );
                    world.add(boxBody);
                    scene.add(boxMesh);
                    boxBody.position.set(x,y,z);
                    boxMesh.position.set(x,y,z);
                    boxMesh.castShadow = true;
                    boxMesh.receiveShadow = true;
                    boxes.push(boxBody);
                    boxMeshes.push(boxMesh);

					
										
		//Library
		     /*
			 // Cylinder
			//var halfExtents = new CANNON.Vec3(12,12,12,8);
            var cylinderShape = new CANNON.Cylinder(12,12,12,8);
			var cylinderGeometry = new THREE.CylinderGeometry(12,12,12,8);
			var cylinderMesh= new THREE.Mesh (cylinderGeometry, patramaterial );
            var cylinderBody = new CANNON.Body({ mass: 0 });
            cylinderBody.addShape(cylinderShape);
							var x = 0;
                    var y = 59;
                    var z = -28;
								world.add(cylinderBody);
			scene.add(cylinderMesh);
            cylinderBody.position.set(x,y,z);
			//cylinderBody.quaternion.setFromAxisAngle(new CANNON.Vec3(0,1,0),Math.PI/3);
			cylinderMesh.position.set(x,y,z);
			boxes.push(cylinderBody);
			boxMeshes.push(cylinderMesh);
			
			*/
			

			
 //Fence1
 var fenceTexture = new THREE.ImageUtils.loadTexture( 'tex/ironfence2.png' );
	fenceTexture.wrapS = fenceTexture.wrapT = THREE.RepeatWrapping; 
	fenceTexture.repeat.set( 48, 1 );
var fencematerial = new THREE.MeshPhongMaterial({
        map: fenceTexture,
		bumpMap: fenceTexture,
		bumpScale: 0.5,
		transparent: true
      });
 var halfExtents = new CANNON.Vec3(0.001,0.75,18);
                var boxShape = new CANNON.Box(halfExtents);
                var boxGeometry = new THREE.BoxGeometry(halfExtents.x,halfExtents.y,36);
				var x = 6;
                    var y = 65.375;
                    var z = 0;
				//var boxBody = new CANNON.Body({ mass: 0 });
				var boxBody = new CANNON.Body({ mass: 0 });
                    boxBody.addShape(boxShape);
                    var boxMesh = new THREE.Mesh( boxGeometry, fencematerial );
                    world.add(boxBody);
                    scene.add(boxMesh);
                    boxBody.position.set(x,y,z);
                    boxMesh.position.set(x,y,z);
                    boxMesh.castShadow = true;
                    boxMesh.receiveShadow = true;
                    boxes.push(boxBody);
                    boxMeshes.push(boxMesh);	
//fence2 
 var halfExtents = new CANNON.Vec3(0.001,0.75,18);
                var boxShape = new CANNON.Box(halfExtents);
                var boxGeometry = new THREE.BoxGeometry(halfExtents.x,halfExtents.y,36);
				var x = -6;
                    var y = 65.3751;
                    var z = 0;
				//var boxBody = new CANNON.Body({ mass: 0 });
				var boxBody = new CANNON.Body({ mass: 0 });
                    boxBody.addShape(boxShape);
                    var boxMesh = new THREE.Mesh( boxGeometry, fencematerial );
                    world.add(boxBody);
                    scene.add(boxMesh);
                    boxBody.position.set(x,y,z);
                    boxMesh.position.set(x,y,z);
                    boxMesh.castShadow = true;
                    boxMesh.receiveShadow = true;
                    boxes.push(boxBody);
                    boxMeshes.push(boxMesh);
					
 //SideWall
 var fenceTexture = new THREE.ImageUtils.loadTexture( 'tex/paints/brickypaint.jpg' );
	fenceTexture.wrapS = fenceTexture.wrapT = THREE.RepeatWrapping; 
	fenceTexture.repeat.set( 24, 1 );
var fencematerial = new THREE.MeshPhongMaterial({
        map: fenceTexture,
		color: 0x000000,
		bumpMap: fenceTexture,
		bumpScale: 0.000,
		transparent: true
      });
 var halfExtents = new CANNON.Vec3(6,1,18);
                var boxShape = new CANNON.Box(halfExtents);
                var boxGeometry = new THREE.BoxGeometry(12,2,36);
				var x = 0;
                    var y = 64;
                    var z = 0;
				//var boxBody = new CANNON.Body({ mass: 0 });
				var boxBody = new CANNON.Body({ mass: 0 });
                    boxBody.addShape(boxShape);
                    var boxMesh = new THREE.Mesh( boxGeometry, fencematerial );
                    world.add(boxBody);
                    scene.add(boxMesh);
                    boxBody.position.set(x,y,z);
                    boxMesh.position.set(x,y,z);
                    boxMesh.castShadow = true;
                    boxMesh.receiveShadow = true;
                    boxes.push(boxBody);
                    boxMeshes.push(boxMesh);	
 //Side Walkways Undersides
 var halfExtents = new CANNON.Vec3(10,1,18);
                var boxShape = new CANNON.Box(halfExtents);
                var boxGeometry = new THREE.BoxGeometry(20,2,36);
				var x = 20;
                    var y = 64;
                    var z = 0;
				//var boxBody = new CANNON.Body({ mass: 0 });
				var boxBody = new CANNON.Body({ mass: 0 });
                    boxBody.addShape(boxShape);
                    var boxMesh = new THREE.Mesh( boxGeometry, fencematerial );
                    world.add(boxBody);
                    scene.add(boxMesh);
                    boxBody.position.set(x,y,z);
                    boxMesh.position.set(x,y,z);
                    boxMesh.castShadow = true;
                    boxMesh.receiveShadow = true;
                    boxes.push(boxBody);
                    boxMeshes.push(boxMesh);	
var halfExtents = new CANNON.Vec3(10,1,18);
                var boxShape = new CANNON.Box(halfExtents);
                var boxGeometry = new THREE.BoxGeometry(20,2,36);
				var x = -20;
                    var y = 64;
                    var z = 0;
				//var boxBody = new CANNON.Body({ mass: 0 });
				var boxBody = new CANNON.Body({ mass: 0 });
                    boxBody.addShape(boxShape);
                    var boxMesh = new THREE.Mesh( boxGeometry, fencematerial );
                    world.add(boxBody);
                    scene.add(boxMesh);
                    boxBody.position.set(x,y,z);
                    boxMesh.position.set(x,y,z);
                    boxMesh.castShadow = true;
                    boxMesh.receiveShadow = true;
                    boxes.push(boxBody);
                    boxMeshes.push(boxMesh);	
//Undercroft
 var halfExtents = new CANNON.Vec3(6,1,18);
                var boxShape = new CANNON.Box(halfExtents);
                var boxGeometry = new THREE.BoxGeometry(12,2,36);
				var x = 0;
                    var y = 64;
                    var z = 18;
				//var boxBody = new CANNON.Body({ mass: 0 });
				var boxBody = new CANNON.Body({ mass: 0 });
                    boxBody.addShape(boxShape);
                    var boxMesh = new THREE.Mesh( boxGeometry, fencematerial );
                    world.add(boxBody);
                    scene.add(boxMesh);
                    boxBody.position.set(x,y,z);
                    boxMesh.position.set(x,y,z);
                    boxMesh.castShadow = true;
                    boxMesh.receiveShadow = true;
                    boxes.push(boxBody);
                    boxMeshes.push(boxMesh);			
				

//Backwall
 var fenceTexture = new THREE.ImageUtils.loadTexture( 'tex/brickunder.jpg' );
	fenceTexture.wrapS = fenceTexture.wrapT = THREE.RepeatWrapping; 
	fenceTexture.repeat.set( 48, 2 );
var fencematerial = new THREE.MeshPhongMaterial({
        map: fenceTexture,
		bumpMap: fenceTexture,
		bumpScale: 0.009,
		transparent: true
      });
 var halfExtents = new CANNON.Vec3(18,1.001,0.001);
                var boxShape = new CANNON.Box(halfExtents);
                var boxGeometry = new THREE.BoxGeometry(36,2.001,0);
				var x = 0;
                    var y = 64;
                    var z = -18;
				//var boxBody = new CANNON.Body({ mass: 0 });
				var boxBody = new CANNON.Body({ mass: 0 });
                    boxBody.addShape(boxShape);
                    var boxMesh = new THREE.Mesh( boxGeometry, fencematerial );
                    world.add(boxBody);
                    scene.add(boxMesh);
                    boxBody.position.set(x,y,z);
                    boxMesh.position.set(x,y,z);
                    boxMesh.castShadow = true;
                    boxMesh.receiveShadow = true;
                    boxes.push(boxBody);
                    boxMeshes.push(boxMesh);							
					
 //
   /* Cylinder shape 2
            var cylinderShape2 = new CANNON.Cylinder(4,4,4,10);
            var q = new CANNON.Quaternion();
            q.setFromAxisAngle(new CANNON.Vec3(0,1,0),Math.PI / 2);
            cylinderShape2.transformAllPoints(new CANNON.Vec3(),q);
            var cylinderBody2 = new CANNON.Body({ mass: 1 });
            cylinderBody2.addShape(cylinderShape2);
            cylinderBody2.position.set(1,65,7);
            world.add(cylinderBody2);
            //demo.addVisual(cylinderBody2);
		*/	
			
 //Building
 var brickTexture1 = new THREE.ImageUtils.loadTexture( 'tex/brick5.jpg' );
	brickTexture1.wrapS = brickTexture1.wrapT = THREE.RepeatWrapping; 
	brickTexture1.repeat.set( 25, 25 );
 var brickTexture2 = new THREE.ImageUtils.loadTexture( 'tex/brick3.jpg' );
	brickTexture2.wrapS = brickTexture2.wrapT = THREE.RepeatWrapping; 
	brickTexture2.repeat.set( 20, 20 );
 var brickTexture3 = new THREE.ImageUtils.loadTexture( 'tex/brick4.jpg' );
	brickTexture3.wrapS = brickTexture3.wrapT = THREE.RepeatWrapping; 
	brickTexture3.repeat.set( 20, 20 );
	
var collisionmat2 = new THREE.MeshBasicMaterial({
    wireframe: true
      });
	  
//Collisionboxes
var collisionmat = new THREE.MeshBasicMaterial({
    transparent: true,
	opacity: 0.0
      });
	  var halfExtents = new CANNON.Vec3(4,8,16);
                var boxShape = new CANNON.Box(halfExtents);
                var boxGeometry = new THREE.BoxGeometry(halfExtents.x*2,halfExtents.y*2,halfExtents.z*2);
				var x = 14;
                    var y = 73;
                    var z = -2;
				//var boxBody = new CANNON.Body({ mass: 0 });
				var boxBody = new CANNON.Body({ mass: 0 });
                    boxBody.addShape(boxShape);
                    var boxMesh = new THREE.Mesh( boxGeometry, collisionmat );
                    world.add(boxBody);
                    scene.add(boxMesh);
                    boxBody.position.set(x,y,z);
                    boxMesh.position.set(x,y,z);
                    boxMesh.castShadow = false;
                    boxMesh.receiveShadow = false;
                    boxes.push(boxBody);
                    boxMeshes.push(boxMesh);	
	  var halfExtents = new CANNON.Vec3(4,6,16);
                var boxShape = new CANNON.Box(halfExtents);
                var boxGeometry = new THREE.BoxGeometry(halfExtents.x*2,halfExtents.y*2,halfExtents.z*2);
				var x = -14;
                    var y = 71;
                    var z = -2;
					
				//var boxBody = new CANNON.Body({ mass: 0 });
				var boxBody = new CANNON.Body({ mass: 0 });
                    boxBody.addShape(boxShape);
                    var boxMesh = new THREE.Mesh( boxGeometry, collisionmat );
                    world.add(boxBody);
                    scene.add(boxMesh);
                    boxBody.position.set(x,y,z);
                    boxMesh.position.set(x,y,z);
                    boxMesh.castShadow = false;
                    boxMesh.receiveShadow = false;
                    boxes.push(boxBody);
                    boxMeshes.push(boxMesh);	
					
               loader.load("models/building.js", 
    function ( obj ) {
	obj.material.map = brickTexture3;
	//obj.material.bumpMap = brickTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 3.999, 3.999, 3.999 );
	   obj.position.set(14, 49, -14);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
               loader.load("models/building.js", 
    function ( obj ) {
	obj.material.map = brickTexture1;
	//obj.material.bumpMap = brickTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 3.999, 3.999, 3.999 );
	   obj.position.set(14, 55, -6);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
               loader.load("models/building.js", 
    function ( obj ) {
	obj.material.map = brickTexture2;
	//obj.material.bumpMap = brickTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 3.999, 3.999, 3.999 );
	   obj.position.set(14, 52, 2);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
               loader.load("models/building.js", 
    function ( obj ) {
	obj.material.map = brickTexture1;
	//obj.material.bumpMap = brickTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 3.999, 3.999, 3.999 );
	   obj.position.set(14, 62, 10);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);

//Other Side
               loader.load("models/building.js", 
    function ( obj ) {
	obj.material.map = brickTexture1;
	//obj.material.bumpMap = brickTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 3.999, 3.999, 3.999 );
	   obj.position.set(-14, 49, -14);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
               loader.load("models/building.js", 
    function ( obj ) {
	obj.material.map = brickTexture2;
	//obj.material.bumpMap = brickTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 3.999, 3.999, 3.999 );
	   obj.position.set(-14, 56, -6);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
               loader.load("models/building.js", 
    function ( obj ) {
	obj.material.map = brickTexture1;
	//obj.material.bumpMap = brickTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 3.999, 3.999, 3.999 );
	   obj.position.set(-14, 52, 2);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
               loader.load("models/building.js", 
    function ( obj ) {
	obj.material.map = brickTexture2;
	//obj.material.bumpMap = brickTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 3.999, 3.999, 3.999 );
	   obj.position.set(-14, 63, 10);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
//ROOF
var roofTexture1 = new THREE.ImageUtils.loadTexture( 'tex/roof1.jpg' );
	roofTexture1.wrapS = roofTexture1.wrapT = THREE.RepeatWrapping; 
	roofTexture1.repeat.set( 6, 6 );   

	var roofTexture2 = new THREE.ImageUtils.loadTexture( 'tex/roof2.jpg' );
	roofTexture2.wrapS = roofTexture2.wrapT = THREE.RepeatWrapping; 
	roofTexture2.repeat.set( 6, 6 ); 	
	
	var roofTexture3 = new THREE.ImageUtils.loadTexture( 'tex/roof3.jpg' );
	roofTexture3.wrapS = roofTexture3.wrapT = THREE.RepeatWrapping; 
	roofTexture3.repeat.set( 6, 6 ); 
		
		var roofTexture4 = new THREE.ImageUtils.loadTexture( 'tex/roof4.jpg' );
	roofTexture4.wrapS = roofTexture4.wrapT = THREE.RepeatWrapping; 
	roofTexture4.repeat.set( 6, 6 ); 
	
	var roofcover1 = new THREE.ImageUtils.loadTexture( 'tex/roofcover.jpg' );
		roofcover1.wrapS = roofcover1.wrapT = THREE.RepeatWrapping; 
	roofcover1.repeat.set( 3, 3 ); 
	
	
				  loader.load("models/buildingroof.js", 
    function ( obj ) {
	obj.material.map = roofTexture1;
	//obj.material.bumpMap = brickTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 3.999, 3.999, 3.999 );
	   obj.position.set(14, 49, -14);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
				  loader.load("models/roofcover.js", 
    function ( obj ) {
	obj.material.map = roofcover1;
	//obj.material.bumpMap = brickTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 3.999, 3.999, 3.999 );
	   obj.position.set(14, 49, -14);
	 obj.castShadow = false;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/buildingroof.js", 
    function ( obj ) {
	obj.material.map = roofTexture2;
	//obj.material.bumpMap = brickTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 3.999, 3.999, 3.999 );
	   obj.position.set(14, 55, -6);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/roofcover.js", 
    function ( obj ) {
	obj.material.map = roofcover1;
	//obj.material.bumpMap = brickTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 3.999, 3.999, 3.999 );
	   obj.position.set(14, 55, -6);
	 obj.castShadow = false;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/buildingroof.js", 
    function ( obj ) {
	obj.material.map = roofTexture3;
	//obj.material.bumpMap = brickTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 3.999, 3.999, 3.999 );
	   obj.position.set(14, 52, 2);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/roofcover.js", 
    function ( obj ) {
	obj.material.map = roofcover1;
	//obj.material.bumpMap = brickTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 3.999, 3.999, 3.999 );
	   obj.position.set(14, 52, 2);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/buildingroof.js", 
    function ( obj ) {
	obj.material.map = roofTexture2;
	//obj.material.bumpMap = brickTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 3.999, 3.999, 3.999 );
	   obj.position.set(14, 62, 10);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/roofcover.js", 
    function ( obj ) {
	obj.material.map = roofcover1;
	//obj.material.bumpMap = brickTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 3.999, 3.999, 3.999 );
	   obj.position.set(14, 62, 10);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/buildingroof.js", 
    function ( obj ) {
	obj.material.map = roofTexture1;
	//obj.material.bumpMap = brickTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 3.999, 3.999, 3.999 );
	   obj.position.set(-14, 49, -14);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/roofcover.js", 
    function ( obj ) {
	obj.material.map = roofcover1;
	//obj.material.bumpMap = brickTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 3.999, 3.999, 3.999 );
	   obj.position.set(-14, 49, -14);
	 obj.castShadow = false;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/buildingroof.js", 
    function ( obj ) {
	obj.material.map = roofTexture2;
	//obj.material.bumpMap = brickTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 3.999, 3.999, 3.999 );
	   obj.position.set(-14, 56, -6);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/roofcover.js", 
    function ( obj ) {
	obj.material.map = roofcover1;
	//obj.material.bumpMap = brickTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 3.999, 3.999, 3.999 );
	   obj.position.set(-14, 56, -6);
	 obj.castShadow = false;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/buildingroof.js", 
    function ( obj ) {
	obj.material.map = roofTexture3;
	//obj.material.bumpMap = brickTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 3.999, 3.999, 3.999 );
	   obj.position.set(-14, 52, 2);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/roofcover.js", 
    function ( obj ) {
	obj.material.map = roofcover1;
	//obj.material.bumpMap = brickTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 3.999, 3.999, 3.999 );
	   obj.position.set(-14, 52, 2);
	 obj.castShadow = false;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/buildingroof.js", 
    function ( obj ) {
	obj.material.map = roofTexture3;
	//obj.material.bumpMap = brickTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 3.999, 3.999, 3.999 );
	   obj.position.set(-14, 63, 10);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/roofcover.js", 
    function ( obj ) {
	obj.material.map = roofcover1;
	//obj.material.bumpMap = brickTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 3.999, 3.999, 3.999 );
	   obj.position.set(-14, 63, 10);
	 obj.castShadow = false;
	 obj.receiveShadow = true;
    }   
);
//Windows etc
var windowTexture1 = new THREE.ImageUtils.loadTexture( 'tex/window1.jpg' );
var windowboxTexture1 = new THREE.ImageUtils.loadTexture( 'tex/windowbox.jpg' );
var doorTexture1 = new THREE.ImageUtils.loadTexture( 'tex/door1.jpg' );
			  loader.load("models/window1.js", 
    function ( obj ) {
	obj.material.map = windowTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(10, 66, 0);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/window1.js", 
    function ( obj ) {
	obj.material.map = windowTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(10, 66, 4);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/windowbox.js", 
    function ( obj ) {
	obj.material.map = windowboxTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(10, 66, 4);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
				  loader.load("models/window1.js", 
    function ( obj ) {
	obj.material.map = windowTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(10, 70, 4);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);	

				  loader.load("models/window1.js", 
    function ( obj ) {
	obj.material.map = windowTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(10, 70, 0);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);	

			  loader.load("models/window1.js", 
    function ( obj ) {
	obj.material.map = windowTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(10, 66, -4);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/window1.js", 
    function ( obj ) {
	obj.material.map = windowTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(10, 66, -6);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/window1.js", 
    function ( obj ) {
	obj.material.map = windowTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(10, 66, -8);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);			  
				  loader.load("models/window1.js", 
    function ( obj ) {
	obj.material.map = windowTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(10, 70, -4);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);		
				  loader.load("models/window1.js", 
    function ( obj ) {
	obj.material.map = windowTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(10, 70, -6);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);		
				  loader.load("models/windowbox.js", 
    function ( obj ) {
	obj.material.map = windowboxTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(10, 70, -6);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);		    
			  loader.load("models/window1.js", 
    function ( obj ) {
	obj.material.map = windowTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(10, 70, -8);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/windowbox.js", 
    function ( obj ) {
	obj.material.map = windowboxTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(10, 66, -8);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/window1.js", 
    function ( obj ) {
	obj.material.map = windowTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(10, 66, -12);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/windowbox.js", 
    function ( obj ) {
	obj.material.map = windowboxTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(10, 66, -12);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/window1.js", 
    function ( obj ) {
	obj.material.map = windowTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(10, 66, -16);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/window1.js", 
    function ( obj ) {
	obj.material.map = windowTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 270 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(-10, 66, -16);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/windowbox.js", 
    function ( obj ) {
	obj.material.map = windowboxTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 270 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(-10, 66, -16);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/window1.js", 
    function ( obj ) {
	obj.material.map = windowTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 270 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(-10, 66, -12);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/window1.js", 
    function ( obj ) {
	obj.material.map = windowTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 270 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(-10, 66, -8);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/window1.js", 
    function ( obj ) {
	obj.material.map = windowTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 270 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(-10, 66, -4);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/window1.js", 
    function ( obj ) {
	obj.material.map = windowTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 270 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(-10, 66, 2);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/window1.js", 
    function ( obj ) {
	obj.material.map = windowTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 270 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(-10, 66, 8);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/window1.js", 
    function ( obj ) {
	obj.material.map = windowTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 270 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(-10, 66, 12);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/window1.js", 
    function ( obj ) {
	obj.material.map = windowTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 270 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(-10, 70, 8);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/window1.js", 
    function ( obj ) {
	obj.material.map = windowTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 270 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(-10, 70, 12);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/window1.js", 
    function ( obj ) {
	obj.material.map = windowTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 270 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(-10, 74, 8);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/window1.js", 
    function ( obj ) {
	obj.material.map = windowTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 270 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(-10, 74, 12);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/window1.js", 
    function ( obj ) {
	obj.material.map = windowTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 270 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(-10, 78, 8);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/window1.js", 
    function ( obj ) {
	obj.material.map = windowTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 270 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(-10, 78, 12);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/window1.js", 
    function ( obj ) {
	obj.material.map = windowTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y =  270 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(10, 66, 8);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/window1.js", 
    function ( obj ) {
	obj.material.map = windowTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y =  270 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(10, 66, 12);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/window1.js", 
    function ( obj ) {
	obj.material.map = windowTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 270 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(-10, 68, 4);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/window1.js", 
    function ( obj ) {
	obj.material.map = windowTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 270 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(-10, 68, 0);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
 loader.load("models/window1.js", 
    function ( obj ) {
	obj.material.map = windowTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y =  270 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(10, 70, 8);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/window1.js", 
    function ( obj ) {
	obj.material.map = windowTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y =  270 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(10, 70, 12);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/window1.js", 
    function ( obj ) {
	obj.material.map = windowTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y =  270 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(10, 74, 8);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/window1.js", 
    function ( obj ) {
	obj.material.map = windowTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y =  270 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(10, 74, 12);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/window1.js", 
    function ( obj ) {
	obj.material.map = windowTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y =  270 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(10, 78, 8);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
			  loader.load("models/window1.js", 
    function ( obj ) {
	obj.material.map = windowTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y =  270 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(10, 78, 12);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);


//Other Building Details
//CuckooPub		
var cuckootex = new THREE.ImageUtils.loadTexture( 'tex/details/cuckoosrest.jpg' );
var cuckoosignmaterial = new THREE.MeshLambertMaterial( {map:cuckootex} );
var cuckoosign = new THREE.Mesh( new THREE.PlaneGeometry( 4, 0.8, 1 ), cuckoosignmaterial );
scene.add( cuckoosign );
cuckoosign.position.set(9.999,68,2);
cuckoosign.rotation.y = - 90 * ( Math.PI / 180 );

var shoetex = new THREE.ImageUtils.loadTexture( 'tex/details/shoemakersign.jpg' );
var shoesignmaterial = new THREE.MeshLambertMaterial( {map:shoetex} );
var shoesign = new THREE.Mesh( new THREE.PlaneGeometry( 4, 0.8, 1 ), shoesignmaterial );
scene.add( shoesign );
shoesign.position.set(-9.999,68,-6);
shoesign.rotation.y =   90 * ( Math.PI / 180 );


	loader.load("models/window1.js", 
    function ( obj ) {
	obj.material.map = windowTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 180 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(16, 65.75, -18);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
/*var libsigntex = new THREE.ImageUtils.loadTexture( 'tex/details/libraryfleg.jpg' );
var libsignmaterial = new THREE.MeshLambertMaterial( {map:libsigntex} );
var libsign = new THREE.Mesh( new THREE.PlaneGeometry( 2, 6, 1 ), libsignmaterial );
scene.add( libsign );
libsign.position.set(14,75,14.001);
*/
	loader.load("models/windowbox.js", 
    function ( obj ) {
	obj.material.map = windowboxTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 180 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.4, 0.4, 0.4 );
	   obj.position.set(16, 65.75, -18);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
	loader.load("models/door1.js", 
    function ( obj ) {
	obj.material.map = doorTexture1;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y = - 180 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.275, 0.275, 0.275);
	   obj.position.set(12, 65, -18);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
var pedtex = new THREE.ImageUtils.loadTexture( 'tex/iron.jpg' );
	loader.load("models/brazier.js", 
    function ( obj ) {
	obj.material.map = pedtex;
	//obj.material.bumpMap = windowTexture1;
	//obj.material.bumpScale = 0.015;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
       scene.add( obj );
	   obj.rotation.y =   90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.8, 0.8, 0.8);
	   obj.position.set(13, 65.5, -18);
	 obj.castShadow = true;
	 obj.receiveShadow = true;

    }   
);
	 var balllight = new THREE.PointLight(0xFF9500, 1, 6 );
scene.add(balllight);
balllight.position.set(13,66,-18.4);

//Library

 var libTexture = new THREE.ImageUtils.loadTexture( 'tex/libbricknice.jpg' );
	libTexture.wrapS = libTexture.wrapT = THREE.RepeatWrapping; 
	libTexture.repeat.set( 10000, 20000 );
	 var libbumpTexture = new THREE.ImageUtils.loadTexture( 'tex/libbricknice.jpg' );
	libbumpTexture.wrapS = libbumpTexture.wrapT = THREE.RepeatWrapping; 
	libbumpTexture.repeat.set( 10000, 20000);
	 	
var libext = new THREE.ImageUtils.loadTexture("tex/libbrick.jpg")     
libext.wrapS	= THREE.RepeatWrapping;
	libext.wrapT	= THREE.RepeatWrapping;
	libext.repeat.x= 200
	libext.repeat.y= 200
var libextmaterial = new THREE.MeshPhongMaterial({
        map: libTexture,
		bumpMap: libbumpTexture,
		bumpScale: 0.00,
      });	
	  //was 24
var loader = new THREE.ObjectLoader();	
loader.load("models/library.js", 
    function ( obj ) {
	obj.material.map = libext;
	obj.material.bumpMap = libext;
	obj.material.bumpScale = 0.00;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 1.4;
	obj.material.shading = THREE.SmoothShading;
	obj.material.side = THREE.FrontSide;
       scene.add( obj );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 1, 1, 1 );
	   obj.position.set(0,65,-90);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);	  

//Library Interior

 	var libint = new THREE.ImageUtils.loadTexture("tex/Bookshelves.jpg")     
libint.wrapS	= THREE.RepeatWrapping;
	libint.wrapT	= THREE.RepeatWrapping;
	libint.repeat.x= 800
	libint.repeat.y= 800
var loader = new THREE.ObjectLoader();	
loader.load("models/library.js", 
    function ( obj ) {
	obj.material.map = libint;
	obj.material.bumpMap = libint;
	obj.material.bumpScale = 0.05;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 1.4;
	obj.material.shading = THREE.SmoothShading;
	obj.material.side = THREE.BackSide;
       scene.add( obj );
	   obj.scale.set(1, 1, 1);
	   //var basescale = 2.68125;
	  // obj.scale.set( 1, 1, 1 );
	   obj.position.set(0,65,-90);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);	  
//Inner Light
 lightlib = new THREE.SpotLight( 0x8CFAFA,1.5 );
                 lightlib.position.set( 0, 89, -90 );
                lightlib.target.position.set( 0, 65, -90 );
scene.add(lightlib);

//Tank
 	var bookreflection = new THREE.ImageUtils.loadTexture("tex/Bookshelves.jpg")  ;
var geometry = new THREE.CylinderGeometry( 5, 5, 20, 32 );
tcubemap = THREE.ImageUtils.loadTextureCube(bookreflection);
var tankMaterial = new THREE.MeshLambertMaterial( {color: 0x000022, envMap:tcubemap, combine: THREE.MixOperation, 
        reflectivity: 0.25} );
var tank = new THREE.Mesh( geometry, tankMaterial );
scene.add( tank );
tank.position.set(0,65,0);

//Library Door
 	var libdoor = new THREE.ImageUtils.loadTexture("tex/libdoor2.jpg"); 
var loader = new THREE.ObjectLoader();	
loader.load("models/libdoor.js", 
    function ( obj ) {
	obj.material.map = libdoor;
	//obj.material.bumpMap = libext;
	//obj.material.bumpScale = 0.05;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
	obj.material.shading = THREE.SmoothShading;
	obj.material.side = THREE.FrontSide;
       scene.add( obj );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 1.2, 1.2, 0.9 );
	   obj.position.set(0,65,-87);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);	  
//DragonWitch
/*
 	var dragonwitch = new THREE.ImageUtils.loadTexture("tex/dragonwitchtex.jpg"); 
var loader = new THREE.ObjectLoader();	
loader.load("models/dragonwitch.js", 
    function ( obj ) {
	obj.material.map = dragonwitch;
	obj.material.bumpMap = dragonwitch;
	obj.material.bumpScale = 0.005;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
	obj.material.shading = THREE.NoShading;
	obj.material.side = THREE.DoubleSide;
       scene.add( obj );
	   obj.rotation.y = - 90 * ( Math.PI / 180 );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   //var basescale = 2.68125;
	   obj.scale.set( 0.12, 0.12, 0.12 );
	   obj.position.set(0,65,-8);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);
var halfExtents = new CANNON.Vec3(0.25,0.5,0.25);
                var boxShape = new CANNON.Box(halfExtents);
                var boxGeometry = new THREE.BoxGeometry(halfExtents.x*2,halfExtents.y*2,halfExtents.z*2);
				var x = 0;
                    var y = 65.5;
                    var z = -8;
				//var boxBody = new CANNON.Body({ mass: 0 });
				var boxBody = new CANNON.Body({mass:0});
                    boxBody.addShape(boxShape);
					wireframematerial = new THREE.MeshBasicMaterial({
    color: 0xFAF205,
    wireframe: true
});
                    var boxMesh = new THREE.Mesh( boxGeometry, wireframematerial );
                    world.add(boxBody);
                    scene.add(boxMesh);
                    boxBody.position.set(x,y,z);
                    boxMesh.position.set(x,y,z);
                    boxMesh.castShadow = true;
                    boxMesh.receiveShadow = true;
                    boxes.push(boxBody);
                    boxMeshes.push(boxMesh);	


*/
/*					
 var libTexture = new THREE.ImageUtils.loadTexture( 'tex/details/ivy.gif' );
	libTexture.wrapS = libTexture.wrapT = THREE.RepeatWrapping; 
	libTexture.repeat.set( 8, 1 );
var libextmaterial = new THREE.MeshLambertMaterial({
        map: libTexture,
		transparent:true
      });		  
var libextgeometry = new THREE.CylinderGeometry( 30.01, 30.01, 0, 8 );
var libextcylinder = new THREE.Mesh( libextgeometry, libextmaterial );
scene.add( libextcylinder );	
//libextcylinder.position.set(0,285,-90);	
libextcylinder.position.set(0,380,-90);		
                    libextcylinder.castShadow = true;
                    libextcylinder.receiveShadow = true;
					libextcylinder.rotation.y = - 22.5 * ( Math.PI / 180 );
*/
					//Libraryfloorbase
 var libTexture = new THREE.ImageUtils.loadTexture( 'tex/libbase.jpg' );
	libTexture.wrapS = libTexture.wrapT = THREE.RepeatWrapping; 
	libTexture.repeat.set( 52, 0.5 );
	 var libbumpTexture = new THREE.ImageUtils.loadTexture( 'tex/libbase.jpg' );
	libbumpTexture.wrapS = libbumpTexture.wrapT = THREE.RepeatWrapping; 
	libbumpTexture.repeat.set( 52, 0.5);
var libextmaterial = new THREE.MeshPhongMaterial({
        map: libTexture,
		bumpMap: libbumpTexture,
		bumpScale: 0.1,
      });	
var libextgeometry = new THREE.CylinderGeometry( 30.5, 30.5, 2, 8 );
var libextcylinder = new THREE.Mesh( libextgeometry, libextmaterial );
scene.add( libextcylinder );	
libextcylinder.position.set(0,64,-90);		
                    libextcylinder.castShadow = true;
                    libextcylinder.receiveShadow = true;
					libextcylinder.rotation.y = - 22.5 * ( Math.PI / 180 );
					
var libTexture = new THREE.ImageUtils.loadTexture( 'tex/street2.jpg' );
	libTexture.wrapS = libTexture.wrapT = THREE.RepeatWrapping; 
	libTexture.repeat.set( 76.25, 76.25 );
	 var libbumpTexture = new THREE.ImageUtils.loadTexture( 'tex/street3-bump.jpg' );
	libbumpTexture.wrapS = libbumpTexture.wrapT = THREE.RepeatWrapping; 
	libbumpTexture.repeat.set( 76.25, 76.25);
var libextmaterial = new THREE.MeshPhongMaterial({
        map: libTexture,
		bumpMap: libbumpTexture,
		bumpScale: 0.0085,
      });	
basegeometry = new THREE.CircleGeometry( 30.5, 8 );
var libextfloor = new THREE.Mesh( basegeometry, libextmaterial );
scene.add(libextfloor);
libextfloor.position.set(0,65.0022,-90);
libextfloor.rotation.x= - 90 * ( Math.PI / 180 );
libextfloor.rotation.z= - 22.5 * ( Math.PI / 180 );
libextfloor.receiveShadow=true;
libextfloor.castShadow=false;
var halfExtents = new CANNON.Vec3(30,0.002,30);
                var boxShape = new CANNON.Box(halfExtents);
                var boxGeometry = new THREE.BoxGeometry(halfExtents.x*2,halfExtents.y*2,halfExtents.z*2);
				var x = 0;
                    var y = 64.9999;
                    var z = -90;
				//var boxBody = new CANNON.Body({ mass: 0 });
				var boxBody = new CANNON.Body({ mass: 0 });
                    boxBody.addShape(boxShape);
                    var boxMesh = new THREE.Mesh( boxGeometry, collisionmat );
                    world.add(boxBody);
                    scene.add(boxMesh);
                    boxBody.position.set(x,y,z);
                    boxMesh.position.set(x,y,z);
                    boxMesh.castShadow = false;
                    boxMesh.receiveShadow = false;
                    boxes.push(boxBody);
                    boxMeshes.push(boxMesh);
	//Library Base
	//texture repeat was 4 and it was perfect
	var base = new THREE.ImageUtils.loadTexture("tex/rockbase.jpg")     
base.wrapS	= THREE.RepeatWrapping;
	base.wrapT	= THREE.RepeatWrapping;
	base.repeat.x= 8
	base.repeat.y= 8
					var loader = new THREE.ObjectLoader();	
loader.load("models/librarybase.js", 
    function ( obj ) {
	obj.material.map = base;
	obj.material.bumpMap = base;
	obj.material.bumpScale = 0.5;
	//obj.material.emmissive = 0xcccccc;
	obj.material.shininess = 0.4;
	obj.material.shading = THREE.SmoothShading;
       scene.add( obj );
	   //obj.scale.set(2.145,2,2.145,2.145);
	   var basescale = 2.68125;
	   obj.scale.set( 2.68125, 2.68125, 2.68125 );
	   obj.position.set(0,63,-90);
	 obj.castShadow = true;
	 obj.receiveShadow = true;
    }   
);

//Bridge
					 var floorTexture = new THREE.ImageUtils.loadTexture( 'tex/street2.jpg' );
	floorTexture.wrapS = floorTexture.wrapT = THREE.RepeatWrapping; 
	floorTexture.repeat.set(12, 30 );
	 var floorbumpTexture = new THREE.ImageUtils.loadTexture( 'tex/street3-bump.jpg' );
	floorbumpTexture.wrapS = floorbumpTexture.wrapT = THREE.RepeatWrapping; 
	floorbumpTexture.repeat.set( 12, 30 );
	var patramaterial = new THREE.MeshPhongMaterial({
        map: floorTexture,
		bumpMap: floorbumpTexture,
		bumpScale: 0.0085
      });
 var halfExtents = new CANNON.Vec3(4,0.002,10);
                var boxShape = new CANNON.Box(halfExtents);
                var boxGeometry = new THREE.BoxGeometry(halfExtents.x*2,halfExtents.y*2,halfExtents.z*2);
				var x = 0;
                    var y = 65;
                    var z = -52;
				//var boxBody = new CANNON.Body({ mass: 0 });
				var boxBody = new CANNON.Body({ mass: 0 });
                    boxBody.addShape(boxShape);
                    var boxMesh = new THREE.Mesh( boxGeometry, patramaterial );
                    world.add(boxBody);
                    scene.add(boxMesh);
                    boxBody.position.set(x,y,z);
                    boxMesh.position.set(x,y,z);
                    boxMesh.castShadow = true;
                    boxMesh.receiveShadow = true;
                    boxes.push(boxBody);
                    boxMeshes.push(boxMesh);
//Lower Bridge
var bridgeTexture = new THREE.ImageUtils.loadTexture( 'tex/libbase.jpg' );
	bridgeTexture.wrapS = libTexture.wrapT = THREE.RepeatWrapping; 
	bridgeTexture.repeat.set( 13, 1 );
var bridgeextmaterial = new THREE.MeshPhongMaterial({
        map: bridgeTexture,
		bumpMap: bridgeTexture,
		bumpScale: 0.1,
      });	
var halfExtents = new CANNON.Vec3(4,0.5,10);
                var boxShape = new CANNON.Box(halfExtents);
                var boxGeometry = new THREE.BoxGeometry(halfExtents.x*2,halfExtents.y*2,halfExtents.z*2);
				var x = 0;
                    var y = 64.5;
                    var z = -52;
				//var boxBody = new CANNON.Body({ mass: 0 });
				var boxBody = new CANNON.Body({ mass: 0 });
                    boxBody.addShape(boxShape);
                    var boxMesh = new THREE.Mesh( boxGeometry, bridgeextmaterial );
                    world.add(boxBody);
                    scene.add(boxMesh);
                    boxBody.position.set(x,y,z);
                    boxMesh.position.set(x,y,z);
                    boxMesh.castShadow = true;
                    boxMesh.receiveShadow = true;
                    boxes.push(boxBody);
                    boxMeshes.push(boxMesh);
	//Fence1
 var fenceTexture = new THREE.ImageUtils.loadTexture( 'tex/ironfence2.png' );
	fenceTexture.wrapS = fenceTexture.wrapT = THREE.RepeatWrapping; 
	fenceTexture.repeat.set( 25, 1 );
var fencematerial = new THREE.MeshPhongMaterial({
        map: fenceTexture,
		bumpMap: fenceTexture,
		bumpScale: 0.5,
		transparent: true
      });
 var halfExtents = new CANNON.Vec3(0.001,0.75,10);
                var boxShape = new CANNON.Box(halfExtents);
				//z is double the Vec3 for z in halfExtents
                var boxGeometry = new THREE.BoxGeometry(halfExtents.x,halfExtents.y,20);
				var x = 4;
                    var y = 65.375;
                    var z = -52.25;
				//var boxBody = new CANNON.Body({ mass: 0 });
				var boxBody = new CANNON.Body({ mass: 0 });
                    boxBody.addShape(boxShape);
                    var boxMesh = new THREE.Mesh( boxGeometry, fencematerial );
                    world.add(boxBody);
                    scene.add(boxMesh);
                    boxBody.position.set(x,y,z);
                    boxMesh.position.set(x,y,z);
                    boxMesh.castShadow = true;
                    boxMesh.receiveShadow = true;
                    boxes.push(boxBody);
                    boxMeshes.push(boxMesh);	

 var halfExtents = new CANNON.Vec3(0.001,0.75,10);
                var boxShape = new CANNON.Box(halfExtents);
				//z is double the Vec3 for z in halfExtents
                var boxGeometry = new THREE.BoxGeometry(halfExtents.x,halfExtents.y,20);
				var x = -4;
                    var y = 65.375;
                    var z = -52.25;
				//var boxBody = new CANNON.Body({ mass: 0 });
				var boxBody = new CANNON.Body({ mass: 0 });
                    boxBody.addShape(boxShape);
                    var boxMesh = new THREE.Mesh( boxGeometry, fencematerial );
                    world.add(boxBody);
                    scene.add(boxMesh);
                    boxBody.position.set(x,y,z);
                    boxMesh.position.set(x,y,z);
                    boxMesh.castShadow = true;
                    boxMesh.receiveShadow = true;
                    boxes.push(boxBody);
                    boxMeshes.push(boxMesh);	
					
// SKY?
var path = "tex/sunnysky/";
                var format = '.jpg';
                var urls = [
                    path + 'px' + format, path + 'nx' + format,
                    path + 'py' + format, path + 'ny' + format,
                    path + 'pz' + format, path + 'nz' + format
                ];

                skyCubemap = THREE.ImageUtils.loadTextureCube( urls );

                var shader = THREE.ShaderLib["cube"];
                shader.uniforms["tCube"].value = skyCubemap;

                // We're inside the box, so make sure to render the backsides
                // It will typically be rendered first in the mainScene and without depth so anything else will be drawn in front
                var skyMaterial = new THREE.ShaderMaterial({
                    fragmentShader : shader.fragmentShader,
                    vertexShader   : shader.vertexShader,
                    uniforms       : shader.uniforms,
                    depthWrite     : false,
                    side           : THREE.BackSide
                });

                // The box dimension size doesn't matter that much when the mainCamera is in the centre.  Experiment with the values.
                skyboxMesh = new THREE.Mesh(new THREE.CubeGeometry(20000, 20000, 20000, 1, 1, 1), skyMaterial);
                scene.add(skyboxMesh);
				//skyboxMesh.rotation.y = -  * ( Math.PI / 180 );
					
				// Add linked boxes
                var size = 0.5;
                var he = new CANNON.Vec3(size,size,size*0.1);
                var boxShape = new CANNON.Box(he);
                var mass = 0;
                var space = 0.1 * size;
                var N = 5, last;
                var boxGeometry = new THREE.BoxGeometry(he.x*2,he.y*2,he.z*2);
                for(var i=0; i<N; i++){
                    var boxbody = new CANNON.Body({ mass: mass });
                    boxbody.addShape(boxShape);
                    var boxMesh = new THREE.Mesh(boxGeometry, material);
                    boxbody.position.set(5,(N-i)*(size*2+2*space) + size*2+space,0);
                    boxbody.linearDamping = 0.01;
                    boxbody.angularDamping = 0.01;
                    // boxMesh.castShadow = true;
                    boxMesh.receiveShadow = true;
                    world.add(boxbody);
                    scene.add(boxMesh);
                    boxes.push(boxbody);
                    boxMeshes.push(boxMesh);


                    if(i!=0){
                        // Connect this body to the last one
                        var c1 = new CANNON.PointToPointConstraint(boxbody,new CANNON.Vec3(-size,size+space,0),last,new CANNON.Vec3(-size,-size-space,0));
                        var c2 = new CANNON.PointToPointConstraint(boxbody,new CANNON.Vec3(size,size+space,0),last,new CANNON.Vec3(size,-size-space,0));
                        world.addConstraint(c1);
                        world.addConstraint(c2);
                    } else {
                        mass=0.3;
                    }
                    last = boxbody;
                }
            }

            function onWindowResize() {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize( window.innerWidth, window.innerHeight );
            }

            var dt = 1/60;
            function animate() {
			stats.begin();
			stats.end();
                requestAnimationFrame( animate );
                if(controls.enabled){
                    world.step(dt);

                    // Update ball positions
                    for(var i=0; i<balls.length; i++){
                        ballMeshes[i].position.copy(balls[i].position);
                        ballMeshes[i].quaternion.copy(balls[i].quaternion);
                    }

                    // Update box positions
                    for(var i=0; i<boxes.length; i++){
                        boxMeshes[i].position.copy(boxes[i].position);
                        boxMeshes[i].quaternion.copy(boxes[i].quaternion);
                    }
                }

                controls.update( Date.now() - time );
                renderer.render( scene, camera );
                time = Date.now();

            }

            var ballShape = new CANNON.Sphere(0.1);
            var ballGeometry = new THREE.SphereGeometry(ballShape.radius, 24, 24);
            var shootDirection = new THREE.Vector3();
            var shootVelo = 80;
            var projector = new THREE.Projector();
            function getShootDir(targetVec){
                var vector = targetVec;
                targetVec.set(0,0,1);
                projector.unprojectVector(vector, camera);
                var ray = new THREE.Ray(sphereBody.position, vector.sub(sphereBody.position).normalize() );
                targetVec.x = ray.direction.x;
                targetVec.y = ray.direction.y;
                targetVec.z = ray.direction.z;
            }

            window.addEventListener("click",function(e){
                if(controls.enabled==true){
                    var x = sphereBody.position.x;
                    var y = sphereBody.position.y;
                    var z = sphereBody.position.z;
                    var ballBody = new CANNON.Body({ mass: 1 });
                    ballBody.addShape(ballShape);
                    var ballMesh = new THREE.Mesh( ballGeometry, spellmaterial );
					var balllight = new THREE.PointLight(0xFF9500, 1, 10 );
					ballMesh.add(balllight);
					balllight.position.set(0,0,1);
                    world.add(ballBody);
                    scene.add(ballMesh);
                    ballMesh.castShadow = false;
                    ballMesh.receiveShadow = true;
                    balls.push(ballBody);
                    ballMeshes.push(ballMesh);
                    getShootDir(shootDirection);
                    ballBody.velocity.set(  shootDirection.x * shootVelo,
                                            shootDirection.y * shootVelo,
                                            shootDirection.z * shootVelo);

                    // Move the ball outside the player sphere
                    x += shootDirection.x * (sphereShape.radius*1.02 + ballShape.radius);
                    y += shootDirection.y * (sphereShape.radius*1.02 + ballShape.radius);
                    z += shootDirection.z * (sphereShape.radius*1.02 + ballShape.radius);
                    ballBody.position.set(x,y,z);
                    ballMesh.position.set(x,y,z);
                }
            });

        </script>
    </body>
</html>
